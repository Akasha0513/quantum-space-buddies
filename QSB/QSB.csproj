<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <AssemblyTitle>Quantum Space Buddies</AssemblyTitle>
    <Description>Multiplayer mod for Outer Wilds</Description>
    <Product>Quantum Space Buddies</Product>
    <RunPostBuildEvent>OnBuildSuccess</RunPostBuildEvent>
    <ProjectGuid>{1F00090A-C697-4C55-B401-192F3CFB9DC2}</ProjectGuid>
    <OutputPath Condition="Exists('$(OwmlDir)')">$(OwmlDir)\Mods\QSB</OutputPath>
    <NoWarn>CS1998;CS0649</NoWarn>
  </PropertyGroup>

  <Target Name="clean before building" BeforeTargets="PreBuildEvent">
    <Exec Command="del /f /q &quot;$(OutputPath)\*.dll&quot;" IgnoreExitCode="true" />
    <Exec Command="del /f /q &quot;$(OutputPath)\*.exe&quot;" IgnoreExitCode="true" />
    <Exec Command="del /f /q &quot;$(OutputPath)\*.pdb&quot;" IgnoreExitCode="true" />
    <Exec Command="del /f /q &quot;$(OutputPath)\AssetBundles\*&quot;" IgnoreExitCode="true" />
  </Target>

  <PropertyGroup>
    <GameDllsDir Condition="Exists('$(GameDir)')">$(GameDir)\OuterWilds_Data\Managed</GameDllsDir>
    <UnityDllsDir Condition="Exists('$(UnityAssetsDir)')">$(UnityAssetsDir)\Dlls</UnityDllsDir>
  </PropertyGroup>
  <Target Name="remove dumb files" AfterTargets="PostBuildEvent">
    <Exec Command="del /f /q &quot;$(OutputPath)\*.exe.config&quot;" />
  </Target>
  <Target Name="weave qsb" AfterTargets="PostBuildEvent">
    <Exec Command="&quot;..\MirrorWeaver\bin\$(Configuration)\MirrorWeaver&quot; &quot;$(TargetPath)&quot; ..\GameDlls" />
  </Target>
  <Target Name="inject proxy scripts" AfterTargets="PostBuildEvent" Condition="Exists('$(GameDllsDir)')">
    <Exec Command="&quot;..\ProxyInjector\bin\$(Configuration)\ProxyInjector&quot; &quot;$(TargetPath)&quot; &quot;$(GameDllsDir)\Assembly-CSharp.dll&quot;" />
  </Target>
  <Target Name="copy dlls to unity" AfterTargets="PostBuildEvent" Condition="Exists('$(UnityDllsDir)') and Exists('$(GameDllsDir)')">
    <Exec Command="del /f /q &quot;$(UnityDllsDir)\*.dll&quot;" />
    <Exec Command="del /f /q &quot;$(UnityDllsDir)\*.exe&quot;" />

    <Exec Command="copy /y &quot;$(OutputPath)\*.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(OutputPath)\*.exe&quot; &quot;$(UnityDllsDir)&quot;" />

    <Exec Command="copy /y &quot;$(GameDllsDir)\Assembly-CSharp*.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\Unity.InputSystem.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\UnityEngine.UI.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\EOS-SDK.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\UniSense.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\Autofac.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\Newtonsoft.Json.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\0Harmony.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\MonoMod*.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\Mono.Cecil.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\OWML*.dll&quot; &quot;$(UnityDllsDir)&quot;" />
    <Exec Command="copy /y &quot;$(GameDllsDir)\NAudio-Unity.dll&quot; &quot;$(UnityDllsDir)&quot;" />
  </Target>

  <ItemGroup>
    <None Include="default-config.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="manifest.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="AssetBundles\*">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Remove="AssetBundles\AssetBundles" />
    <None Remove="AssetBundles\*.manifest" />
    <None Condition="Exists('debugsettings.json')" Include="debugsettings.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="OuterWildsGameLibs" Version="1.1.12.168" IncludeAssets="compile" />
    <Reference Include="..\Mirror\*.dll" />
    <Reference Include="..\UniTask\*.dll" />
    <ProjectReference Include="..\EpicOnlineTransport\EpicOnlineTransport.csproj" />
    <ProjectReference Include="..\EpicRerouter\EpicRerouter.csproj" />
    <ProjectReference Include="..\MirrorWeaver\MirrorWeaver.csproj" ReferenceOutputAssembly="false" />
    <ProjectReference Condition="Exists('$(GameDllsDir)')" Include="..\ProxyInjector\ProxyInjector.csproj" ReferenceOutputAssembly="false" />
    <PackageReference Include="HarmonyX" Version="2.9.0" IncludeAssets="compile" />
    <PackageReference Include="OWML" Version="2.3.2" IncludeAssets="compile" />
  </ItemGroup>
</Project>
